# Template file for 'thorium-reader-bin'
pkgname=thorium-reader-bin
version=3.3.0
revision=1
archs="x86_64"

# Verify exact filename on each release; adjust if upstream changes it
distfiles="https://github.com/edrlab/thorium-reader/releases/download/v${version}/Thorium-${version}.AppImage"
checksum=9fafcb0285a0bf2b49f8cd0b11a779602c4ec8d92179743f09e2de5b6449bb9e


skip_extraction=yes


short_desc="Thorium Reader EPUB reader (official AppImage)"
maintainer="yourname <you@example.invalid>"
license="BSD-3-Clause"
homepage="https://www.edrlab.org/software/thorium-reader/"
nostrip=yes

do_extract() {
	:
}

do_install() {
	appimage="Thorium-${version}.AppImage"

	# Most reliable locations inside the masterdir:
	# - /void-packages/hostdir/distfiles (your tree mount)
	# - /host/distfiles (alternate bind mount used by xbps-src on some setups)
	for d in "/void-packages/hostdir/distfiles" "/host/distfiles" "." "${wrksrc}"; do
		if [ -f "${d}/${appimage}" ]; then
			appimage_path="${d}/${appimage}"
			break
		fi
	done

	if [ -z "${appimage_path}" ]; then
		echo "ERROR: could not find ${appimage} in distfiles." >&2
		echo "Looked in: /void-packages/hostdir/distfiles /host/distfiles" >&2
		echo "Hint: check your host cache: hostdir/distfiles/" >&2
		return 1
	fi

	vmkdir opt/thorium-reader
	vcopy "${appimage_path}" "opt/thorium-reader/ThoriumReader.AppImage"
	chmod 0755 "${DESTDIR}/opt/thorium-reader/ThoriumReader.AppImage"

	# Wrapper in PATH
	vmkdir usr/bin
	cat > "${DESTDIR}/usr/bin/thorium-reader" <<'EOF'
#!/bin/sh
exec /opt/thorium-reader/ThoriumReader.AppImage "$@"
EOF
	chmod 0755 "${DESTDIR}/usr/bin/thorium-reader"

	# Desktop entry
	vmkdir usr/share/applications
	cat > "${DESTDIR}/usr/share/applications/thorium-reader.desktop" <<'EOF'
[Desktop Entry]
Type=Application
Name=Thorium Reader
Comment=EPUB reader
Exec=thorium-reader %u
Terminal=false
Categories=Office;Education;Viewer;
EOF
}
